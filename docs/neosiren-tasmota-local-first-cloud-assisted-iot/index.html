<!DOCTYPE html>
<html lang="en-US" itemscope itemtype="http://schema.org/Blog" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="UTF-8">
    <title>Local First, Cloud Assisted &#9729; MultiSensor</title>
    <base href="https://docodethatmatters.com">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta itemprop="description" content="Guide for flashing a temperature and humidity multisensor with Tasmota for local network first setup." />
    <meta name="description" content="Guide for flashing a temperature and humidity multisensor with Tasmota for local network first setup." />
    <meta name="keywords" content="smart home,smart alarm,neo coolcam siren multisensor,nodered,node red,Tuya,TuyaMCU,Amazon Alexa,Alexa,Tasmota,local iot,low code,flashing,ESP8266,Serial-to-USB Adapter" />
    <meta name="Distribution" content="Global" />
    <meta name="Rating" content="General" />
    <meta name="Robots" content="INDEX,FOLLOW" />
    <meta name="author" content="Do Code That Matters" />
    <meta name="Revisit-after" content="31 Days" />
    <meta name="application-name" content="Do Code That Matters">
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Local First, Cloud Assisted &#9729; MultiSensor - Do Code That Matters" />
    <meta property="og:title" content="Local First, Cloud Assisted &#9729; MultiSensor - Do Code That Matters" />
    <meta property="og:description" content="Guide for flashing a temperature and humidity multisensor with Tasmota for local network first setup." />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://docodethatmatters.com" />
    <meta property="og:site_name" content="Do Code That Matters" />
    <meta name="twitter:description" content="Guide for flashing a temperature and humidity multisensor with Tasmota for local network first setup." />
    <meta name="twitter:creator" content="@skittleson" />
    <meta property="og:image" content="/images/finalResultOfTasmotaUi.png" />
    <link href="/site.css" rel="stylesheet">
    <link rel='manifest' href='/manifest.json'>
    <link type="application/rss+xml" rel="alternate" title="Do Code That Matters - Spencer Kittleson" href="https://docodethatmatters.com/rss.xml" />
    <link type="application/feed+json" rel="alternate" title="Do Code That Matters - Spencer Kittleson" href="https://docodethatmatters.com/feed.json" />
    <link type="text/plain" rel="author" href="https://DoCodeThatMatters.com/humans.txt" />
    <link rel="apple-touch-icon" sizes="57x57" href="/images/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/images/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/images/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inconsolata&display=swap"
      rel="stylesheet"
    />

<body class="dark">
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top navbar dark border-bottom">
        <div class="container">
            <a href="/" class="navbar-brand d-flex align-items-center logo">
                <img class="logo-img" src="images/logoWhiteTrans.png" alt="Do Code That Matters" width="60" height="19" />Do Code That Matters</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
<li class="nav-item">
    <a class="nav-link" href="/blog">Blog</a>
</li>
<li class="nav-item">
    <a class="nav-link" href="/about">About</a>
</li>
                </ul>
            </div>
        </div>
    </nav><main class="container article">
  <div class="row">
    <article class="col-lg-12" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
      <header>
        <meta itemprop="mainEntityOfPage" content="https://DoCodeThatMatters.com/neosiren-tasmota-local-first-cloud-assisted-iot">
        <h1 itemprop="name headline">Local First, Cloud Assisted &#9729; MultiSensor</h1>
        <small>
          <time itemprop="datePublished" datetime="2021-04-27T00:00:00.000Z">Apr 27 2021</time>
          by
          <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a rel="author" itemprop="url" href="https://DoCodeThatMatters.com/about" title="View author biography">
              <span itemprop="name">Spencer Kittleson</span>
            </a>
            <meta itemprop="jobTitle" content="Software Engineer">
          </span>
          <span itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
            <meta itemprop="name" content="Do Code That Matters">
            <span itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
              <meta itemprop="url" content="https://DoCodeThatMatters.com/images/agile.jpg">
            </span>
          </span>
        </small>
        <br />
        <figure itemprop="image" itemscope itemtype="https://schema.org/ImageObject">
          <img itemprop="url contentUrl" alt="Flash MultiSensor with Tasmota" src="/images/finalResultOfTasmotaUi.png">
          <figcaption itemprop="caption">Flash MultiSensor with Tasmota</figcaption>
        </figure>
        <br />
      </header>
      <section itemprop="articleBody" class="article-body">
        <p>Guide for flashing a <a href="https://templates.blakadder.com/neo_coolcam_NAS-AB02W.html">NEO Coolcam Siren with Temperature and Humidity Multisensor</a> with Tasmota for local network first setup.</p>
<h2 id="wiring-guide">Wiring Guide</h2>
<p>This is a condensed guide on flashing with tasmota. A full guide/getting started can be found in the official <a href="https://tasmota.github.io/docs/Getting-Started/">documentation</a>.</p>
<p>In order to flash this device, soldering onto the PCB will be required. There is a plate in the back that needs to be rotated to expose the battery holder.  Once that is open, go ahead and remove the three screws.  The tricky part is soldering onto the all connections. A <a href="https://amzn.to/3sW2QaW">Serial-to-USB Adapter</a> is required. All connections must be made. GPIO0 must be connected to ground (GND) in order to on boot in flash mode.</p>
<table>
<thead>
<tr>
<th><strong>Device - Neo Coolcam</strong></th>
<th><strong>Flasher</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>GPIO0</td>
<td>GND</td>
</tr>
<tr>
<td>GND</td>
<td>GND</td>
</tr>
<tr>
<td>TX</td>
<td>RX</td>
</tr>
<tr>
<td>RX</td>
<td>TX</td>
</tr>
<tr>
<td>3.3v</td>
<td>3.3v</td>
</tr>
</tbody>
</table>
<p><img loading="lazy" src="images/neo_coolcam-markup.jpg" alt="Soldering points" /></p>
<p>Finalized soldering</p>
<p><img loading="lazy" src="images/neo_coolcam-wired-to-flasher.jpg" alt="Wired to flasher" /></p>
<h2 id="flashing">Flashing</h2>
<p>Install esptool. PyPi was quick for this: <a href="https://pypi.org/project/esptool/">https://pypi.org/project/esptool/</a></p>
<p><code>pip install esptool</code></p>
<p>Time to flash. Change the port then run this command in the terminal. Doesn't matter if your Mac, Linux, or Windows when using PyPi.</p>
<p><code>esptool --port COM3 write_flash -fs 1MB -fm dout 0x0 tasmota-sensors.bin</code></p>
<p><img loading="lazy" src="images/flashwithEspTool.png" alt="Flashing Neo Coolcam Multisensor" /></p>
<p>Alternative, you can use a GUI version <a href="https://github.com/tasmota/tasmotizer">Tasmotizer</a></p>
<p>Connect to the access point to configure the default WiFi to connect to your local wifi.</p>
<h2 id="configuration">Configuration</h2>
<p>Apply Template in &quot;Configure Other&quot; <a href="https://templates.blakadder.com/neo_coolcam_NAS-AB02W.html">found here</a>
<code>{&quot;NAME&quot;:&quot;Neo Siren 3in1&quot;,&quot;GPIO&quot;:[255,107,255,108,255,255,0,0,255,255,255,255,255],&quot;FLAG&quot;:0,&quot;BASE&quot;:54}</code></p>
<h3 id="tasmota-console-commands">Tasmota Console Commands</h3>
<table>
<thead>
<tr>
<th><strong>Command</strong></th>
<th><strong>Reason</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Backlog SetOption65 1; SetOption66 1; Module 54</code></td>
<td>Fast power cycle and register as a Tuya module</td>
</tr>
<tr>
<td><code>TuyaMCU 11,104</code></td>
<td>Map alarm siren/led to toggle switch</td>
</tr>
<tr>
<td><code>TuyaMCU 71,105</code></td>
<td>Map indoor temperature</td>
</tr>
<tr>
<td><code>TuyaMCU 73,106</code></td>
<td>Map indoor humidity</td>
</tr>
<tr>
<td><code>TempRes 1</code></td>
<td>Instead of <code>291</code> it will be <code>29.1</code> for temperature</td>
</tr>
<tr>
<td><code>TuyaSend2 113,0</code></td>
<td>Disable temperature alarm. Do with a rule instead</td>
</tr>
<tr>
<td><code>TuyaSend2 114,0</code></td>
<td>Disable humidity alarm. Do with a rule instead</td>
</tr>
</tbody>
</table>
<p>All of this assumes there is a MQTT configured.  The temperature and humidity data wont show unless this is configured.  To undo this, use <code>SetOption66 0</code>. Optional, ensure dpId states were set by running <code>TuyaSend0</code>. Now that everything is hooked up, the data will be polled and reported every so often.  The caveat is not always temperature and humidity.  This must be accounted for later.</p>
<pre><code class="language-log">01:42:21.463 MQT: tele/tasmota_111111/SENSOR = {&quot;Time&quot;:&quot;2021-04-08T01:42:21&quot;,&quot;TuyaSNS&quot;:{&quot;Temperature&quot;:28.5,&quot;Humidity&quot;:4.3},&quot;TempUnit&quot;:&quot;C&quot;}
</code></pre>
<p><img loading="lazy" src="images/finalResultOfTasmotaUi.png" alt="Tasmota Web UI with Tuya temperature, humidity, and siren led power toggle" /></p>
<p>I've also considered using rules to catch the Tuya event then publish the MQTT in that rule.</p>
<h3 id="nodered-and-other-smart-logic">NodeRed and other smart logic</h3>
<p>Setup a MQTT node with <code>tele/tasmota_REPLACEWITHID/SENSOR</code> in NodeRed. Replace the MQTT ID from the Tasmota information screen (Information &gt; MQTT Full Topic).</p>
<p>Add a function node that can handle temperature and/or humidity being undefined.  Optional to add information such as <code>measurement</code> for Graphana.</p>
<pre><code class="language-javascript">msg.measurement = 'siren-tv';
try {
    var payload = JSON.parse(msg.payload);
    if(payload.TuyaSNS){
        msg.payload = {};
        if(payload.TuyaSNS.Temperature){
            msg.payload.Temperature = payload.TuyaSNS.Temperature;
        }
        if(payload.TuyaSNS.Humidity){
            msg.payload.Humidity = payload.TuyaSNS.Humidity * 10;
        }
    }
} catch(ex) {
    node.error(&quot;unable to get temp and humidity&quot;, msg);
    return;
}
return msg;
</code></pre>
<p>To turn on the siren remotely. Send either <code>ON</code> or <code>OFF</code> to the MQTT topic <code>cmnd/tasmota_REPLACEWITHID/POWER</code> A return MQTT message returns with <code>stat/tasmota_REPLACEWITHID/POWER</code></p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://templates.blakadder.com/neo_coolcam_NAS-AB02W.html">https://templates.blakadder.com/neo_coolcam_NAS-AB02W.html</a></li>
<li><a href="https://gist.github.com/patrickdk77/b687448fecff68d8572ac79a27d07862">https://gist.github.com/patrickdk77/b687448fecff68d8572ac79a27d07862</a></li>
<li><a href="https://tasmota.github.io/docs/TuyaMCU/#tuyasend-command-">https://tasmota.github.io/docs/TuyaMCU/#tuyasend-command-</a></li>
</ul>

      </section>
    </article>
  </div>


 See something inaccurate or need more detail? <a
        href="https://github.com/skittleson/DoCodeThatMatters/issues/new?title=Post%20-%20Local+First%2c+Cloud+Assisted+%e2%98%81+MultiSensor">Submit a Pull
        Request</a> to help me out!
      <br />
      <a href="https://www.buymeacoffee.com/skittles">Buy me a ☕ to support!</a>
<hr />

<h3>Latest Posts</h3>
  <ul class="unstyledUl">
    <li>
      <a class="read-more" href="linux-wifi-hotspot-usb3">Linux Wifi Hotspot with PiHole</a>
    </li>
    <li>
      <a class="read-more" href="onboarding-devs">Project Onboarding for New Engineers</a>
    </li>
    <li>
      <a class="read-more" href="skateboard-gear">Parametric Belt Driven 3D Printed Spur Gear for Electric Skateboards</a>
    </li>
    <li>
      <a class="read-more" href="top-nuget-packages">Top 5 Nuget Packages</a>
    </li>
    <li>
      <a class="read-more" href="automate-cleaning-of-air-conditioner-condensate-drain-line">Automate Cleaning of Air Conditioner Condensate Drain Line</a>
    </li>
  </ul>

      
</main>



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/styles/agate.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/csharp.min.js"></script>
<script>hljs.highlightAll();</script>




<script async src="/site.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-93963699-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-93963699-1');
</script>
</body>

</html>