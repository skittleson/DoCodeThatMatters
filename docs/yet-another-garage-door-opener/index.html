<!DOCTYPE html>
<html lang="en-US" itemscope itemtype="http://schema.org/Blog" prefix="og: http://ogp.me/ns#">

<head>
    <title>Yet Another Garage Door Opener</title>
    <meta charset="utf-8">
    <base href="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta itemprop="description" name="description" content="Just another garage door opener using a raspberry pi" />
    <meta name="keywords" content="raspberry pi,bluetooth,garage door opener,liftmaster" />
    <meta name="Distribution" content="Global" />
    <meta name="Rating" content="General" />
    <meta name="Robots" content="INDEX,FOLLOW" />
    <meta name="author" content="Do Code That Matters" />
    <meta name="Revisit-after" content="31 Days" />
    <meta name="application-name" content="Do Code That Matters">
    <meta property="og:title" content="Yet Another Garage Door Opener | Do Code That Matters" />
    <meta property="og:type" content="blog" />
    <meta property="og:description" content="Just another garage door opener using a raspberry pi" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Do Code That Matters" />
    <meta name="twitter:description" content="Just another garage door opener using a raspberry pi" />
    <link href="/css/site.css" rel="stylesheet">
    <link rel='manifest' href='/manifest.webmanifest'>
    <link rel="alternate" type="application/rss+xml" title="My Test Feed" href="https://DoCodeThatMatters.com/rss.xml" />
</head>

<body>

    <header class="navbar">
        <section class="navbar-section">
            <a href="/" class="navbar-brand mr-2">Do Code<div class='small-device'></div> That Matters</a>
            <a href="/blog" class="btn btn-link">Blog</a>
            <a href="/about" class="btn btn-link">About</a>        </section>
    </header><main class="postMain">
  <article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <meta itemprop="mainEntityOfPage" content="yet-another-garage-door-opener">
      <h1 itemprop="name headline">Yet Another Garage Door Opener</h1>
      <small>
        <time itemprop="datePublished" content="2018-05-11T00:00:00.000Z">10 May 2018</time>
        <meta itemprop="dateModified" content="2018-05-11T00:00:00.000Z">
        by
        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
          <a rel="author" itemprop="url" href="https://DoCodeThatMatters.com/about" title="View author biography">
            <span itemprop="name">Spencer Kittleson</span>
          </a>
          <meta itemprop="jobTitle" content="Software Engineer">
        </span>
        <span itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
          <meta itemprop="name" content="Do Code That Matters">
        </span>
      </small>
      <br />
      <figure itemprop="image" itemscope itemtype="https://schema.org/ImageObject">
        <img itemprop="url contentUrl" alt="Raspberry Pi!" src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Raspberry-Pi-2-Bare-BR.jpg/330px-Raspberry-Pi-2-Bare-BR.jpg">
        <figcaption itemprop="caption">Raspberry Pi!</figcaption>
      </figure>
      <br />
    </header>
    <section itemprop="articleBody">
      <p>Another tutorial for building a garage door opener with a raspberry pi. I've left the garage door opened too many times. Source: <a href="https://github.com/skittleson/garage-pi">https://github.com/skittleson/garage-pi</a> This tutorial assumes you have a raspberry pi with wifi and the ability to ssh in.</p>
<h2>Goals</h2>
<ul>
<li>Use Docker so it can easily be shared/restored/etc!</li>
<li>A simple web API for control
<ul>
<li>Use nodejs as much as possible for the build.</li>
</ul>
</li>
<li>Toggle garage door</li>
<li>Status of garage door</li>
<li>Toggle light switch on the garage door</li>
<li>(optional) cheap camera to see what's going on.</li>
</ul>
<h2>What you will need</h2>
<ul>
<li>Relay modules. I only needed one - <a href="https://amzn.to/2RP4zNC">Channel DC 5V Relay Module for Arduino</a></li>
<li>Cheap containers to throw everything into - https://amzn.to/2NEdWwB</li>
<li>A replacement switch for garage door opener - <a href="https://amzn.to/2pShUrK">Liftmaster 41A5273-1 Multi-Function Control Panel</a></li>
<li><a href="https://amzn.to/2RMxQc5">Raspberry Pi 3</a></li>
<li>(optional) great camera for the price! This one has 4 mics and the camera has two zoom modes. <a href="https://amzn.to/2CIAmvF">Sony Play Station Eye Camera for PS3</a></li>
</ul>
<h2>Research &amp; Discover</h2>
<p>There are a ton of these garage door projects. I was inspired by many of them. The LiftMaster garage door system has anti-tamper hardware measures which almost ended the project before it started. I decided to take a gamble and buy another garage door opener circuit that directly connects to the garage door unit. Bingo! Two circuits can be connected at the same time. Docker permissions and finding a base image for the raspberry pi took a few hours. Lesson learned, hardware interaction with docker can take a few extra steps.</p>
<h2>Wiring</h2>
<p>The relay module is stacked on top of the LiftMaster module then taped onto the Raspberry Pi. Note the relay connections are wired for normally opened. (click image to see larger version) Sealed up in a glad container (kinda hacky but it's cheap). This is the LiftMaster circuit. The narrower end has the button for opening the garage. The larger end has the button for the garage door light. The middle points are for the circuit to connect to main garage door unit. GPIO pin layout for the relays &amp; reed switch not including power leads.  Reed switch is connected to the part of the garage door (pin 18 and a ground). Once it moves away, then the reed switch is disconnected.</p>
<p>The entire setup. Messy but it's good enough. Cut some holes with a knife for wires and to hold it in place. The camera has been added with duck tape. Using a standard install of <a href="https://motion-project.github.io/motion_build.html">motion</a> (no dockerfile tho).</p>
<h2>Install</h2>
<p>Install docker on the raspberry pi. <a href="https://www.raspberrypi.org/blog/docker-comes-to-raspberry-pi/">https://www.raspberrypi.org/blog/docker-comes-to-raspberry-pi/</a></p>
<pre><code>curl -sSL https://get.docker.com | sh
</code></pre>
<p>Clone the repo</p>
<pre><code>git clone https://github.com/skittleson/garage-pi
cd garage-pi/
</code></pre>
<p>Run docker build for the image</p>
<pre><code>docker build -t garage-pi .
</code></pre>
<p>Start the docker image in privileged mode. This will expose port 8090 for web access.</p>
<pre><code>docker run -d --privileged -p 8090:8090 --name gpi garage-pi
</code></pre>
<p>Test it</p>
<pre><code>curl http://localhost:8090/api
</code></pre>
<p>Other api commands</p>
<ul>
<li>Status: /api/garage/status</li>
<li>Garage Door Toggle: /api/garage/toggle</li>
<li>Light Toggle: /api/light/toggle</li>
<li>Exit: /api/exit</li>
</ul>
<p>That's it!</p>
<h2>Code</h2>
<p>Simulating the button press for the garage door opener circuit. Relay turns on for 500ms, then off. An interesting issue with the relay. As soon the gpio utility exports, it triggers it on. This code exports then unexports a pin that the relay is on.</p>
<pre><code>let relayButtonPressAction = (pin) =&gt; {
    gpioExport(pin, 'out');
    gpioWrite(pin, 1);
    setTimeout(() =&gt; {
        gpioWrite(pin, 0);
        gpioUnexport(pin);
    }, 500);
}
</code></pre>
<p>There is one python file that checks the status of the garage door. The configuration was different enough where it needed to be done there. The reed switch should always be true until the door has been opened.</p>
<pre><code>import sys
import RPi.GPIO as gpio

pin = int(sys.argv[1])

gpio.setmode(gpio.BCM)
gpio.setup(pin, gpio.IN, pull_up_down=gpio.PUD_UP)

status = gpio.input(pin)
sys.stdout.write(str(status))

gpio.cleanup()
</code></pre>
<p>Open for pull requests! I'm considering on moving all the gpio logic to python then using nodejs as the api router.</p>
<h2>Summary</h2>
<p>Hardware side is built and working. The api has enough information to check and toggle the garage door. Going to create a script to watch the door status with <a href="https://nodered.org/">Node-red</a> due to ease of configuration. This project took about 2 days with testing and debugging. Here is a screenshot of the node-red template. Still a work in progress! The <a href="https://github.com/skittleson/garage-pi/blob/master/garage-pi-node-red-flow.json">flow file</a> is in the repo code. <a href="https://docodethatmatters.com/wp-content/uploads/2018/03/node-red-template-2.png"><img src="https://docodethatmatters.com/wp-content/uploads/2018/03/node-red-template-2-253x300.png" alt=""></a></p>

    </section>
    <span itemprop="publisher" itemscope itemtype="https://schema.org/Person">
      <meta itemprop="name" content="Spencer Kittleson">
    </span>
  </article>
</main>
<aside class="postAside">
  <b>Resources</b>
  <br />
  Twitter: <a href="https://twitter.com/skittleson">@skittleson</a><br />
  GitHub: <a href="https://github.com/skittleson">skittleson</a><br />
  LinkedIn: <a href="https://www.linkedin.com/in/skittleson/">skittleson</a><br />
  StackOverflow: <a href=" https://stackoverflow.com/users/2414540/spencer">spencer</a><br />  <b>Latest Posts</b>
  <ul class="unstyledUl">
  </ul>
  <br />
  <b>Other</b><br />
  See something inaccurate or need more detail? Submit a <a href="https://github.com/skittleson/DoCodeThatMatters">Pull
    Request</a> to help me out!
</aside>

<div id="footer">
    <div class="container">
        <div class="row hidden-xs">
            <div class="col-sm-12 text-center">
                &copy; 2019 Do Code That Matters
            </div>
        </div>
    </div>
</div>
<script async src="js/site.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-93963699-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-93963699-1');
</script>
</body>

</html>